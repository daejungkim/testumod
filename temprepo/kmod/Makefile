export PGTEST CONFIG_PGTEST_OBJ DWC_ETH_QOS_CONFIG_PGTEST
export DEBUGFS CONFIG_DEBUGFS_OBJ DWC_ETH_QOS_CONFIG_DEBUGFS
export PTPSUPPORT CONFIG_PTPSUPPORT_OBJ DWC_ETH_QOS_CONFIG_PTP
export UMODEDRV CONFIG_UMODEDRV_OBJ DWC_ETH_QOS_CONFIG_UMODEDRV
export TALKER CONFIG_TALKER DWC_ETH_QOS_CONFIG_TALKER
export LISTENER CONFIG_LISTENER DWC_ETH_QOS_CONFIG_LISTENER

#default values
#DEBUGFS=y	#debugfs is enabled
#PTPSUPPORT=n	#ptp is disabled
#PGTEST=n	#pg(packet generator) is disabled
#UMODEDRV=n      #user mode driver is disabled 

#EXTRA_CFLAGS+= -D__SMP__

ifeq "$(TALKER)" "y"
CONFIG_TALKER=y
DWC_ETH_QOS_CONFIG_TALKER=-DTALKER
EXTRA_CFLAGS+=-DCONFIG_TALKER
else
CONFIG_TALKER=n
endif

ifeq "$(LISTENER)" "y"
CONFIG_LISTENER=y
DWC_ETH_QOS_CONFIG_LISTENER=-DLISTENER
EXTRA_CFLAGS+=-DCONFIG_LISTENER
else
CONFIG_LISTENER=n
endif


ifeq "$(PGTEST)" "y"
CONFIG_PGTEST_OBJ=y
DWC_ETH_QOS_CONFIG_PGTEST=-DPGTEST
EXTRA_CFLAGS+=-DCONFIG_PGTEST_OBJ
else
CONFIG_PGTEST_OBJ=n
endif

ifeq "$(DEBUGFS)" "y"
CONFIG_DEBUGFS_OBJ=y
DWC_ETH_QOS_CONFIG_DEBUGFS=-DDEBUGFS
EXTRA_CFLAGS+=-DCONFIG_DEBUGFS_OBJ
else
CONFIG_DEBUGFS_OBJ=n
endif

ifeq "$(PTPSUPPORT)" "y"
CONFIG_PTPSUPPORT_OBJ=y
DWC_ETH_QOS_CONFIG_PTP=-DPTPSUPPORT
EXTRA_CFLAGS+=-DCONFIG_PTPSUPPORT_OBJ
else
CONFIG_PTPSUPPORT_OBJ=n
endif

ifeq "$(UMODEDRV)" "y"
CONFIG_UMODEDRV_OBJ=y
DWC_ETH_QOS_CONFIG_UMODEDRV=-DUMODEDRV
EXTRA_CFLAGS+=-DCONFIG_UMODEDRV_OBJ
else
CONFIG_UMODEDRV_OBJ=n
endif

obj-m := DWC_ETH_QOS.o

DWC_ETH_QOS-y += DWC_ETH_QOS_dev.o \
			DWC_ETH_QOS_drv.o \
			DWC_ETH_QOS_desc.o \
			DWC_ETH_QOS_ethtool.o \
			DWC_ETH_QOS_pci.o \
			DWC_ETH_QOS_mdio.o \
			DWC_ETH_QOS_eee.o \

DWC_ETH_QOS-$(CONFIG_DEBUGFS_OBJ) += DWC_ETH_QOS_debug_operation.o
DWC_ETH_QOS-$(CONFIG_PGTEST_OBJ) += DWC_ETH_QOS_pktgen.o
DWC_ETH_QOS-$(CONFIG_PTPSUPPORT_OBJ) += DWC_ETH_QOS_ptp.o
DWC_ETH_QOS-$(CONFIG_UMODEDRV_OBJ) += DWC_ETH_QOS_avb.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
	gcc -g $(DWC_ETH_QOS_CONFIG_PGTEST) $(DWC_ETH_QOS_CONFIG_DEBUGFS) $(DWC_ETH_QOS_CONFIG_PTP) $(DWC_ETH_QOS_CONFIG_UMODEDRV)  $(DWC_ETH_QOS_CONFIG_TALKER) $(DWC_ETH_QOS_CONFIG_LISTENER) DWC_ETH_QOS_api.c -o DWC_ETH_QOS_api

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
	rm -f DWC_ETH_QOS_api

